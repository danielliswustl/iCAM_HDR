function XYZ_adapt  = inv_Cat(imageIn)% written by: Lawrence Taplin and Garrett M. Johnson%%% function to invert the chromatic adaptation transform from% D65 to the "monitor" white so it can be displayed on the "tv."% Note that in the iCAM framework the inverse transform% is done with a single number%% Modified: 01/31/03% First things first...define the XYZ to RGB transform% again using the CIECAM02 transformM = [ [ 0.8562,  0.3372, -0.1934];...        [-0.8360,  1.8327,  0.0033];...        [ 0.0357, -0.0469,  1.0112] ]';Mi = inv(M);xyz_d65 = [ 95.05,  100.0, 108.88];whitepoint = [100.0, 100.0, 100.0];RGB_image = changeColorSpace(imageIn, M);RGB_white = changeColorSpace(whitepoint, M);RGB_d65 = changeColorSpace(xyz_d65, M );% we want to use a complete adaptation transform, so% keep D set to 1.0, and don't try to calculate itD = 1;Rc = (D * RGB_white(1) ./ RGB_d65(1) + 1 - D) .* RGB_image(:,:,1);Gc = (D * RGB_white(2) ./ RGB_d65(2) + 1 - D) .* RGB_image(:,:,2);Bc = (D * RGB_white(3) ./ RGB_d65(3) + 1 - D) .* RGB_image(:,:,3);imSize = size(imageIn);xDim = imSize(2);yDim = imSize(1);adaptImage = zeros(yDim, xDim,3);adaptImage(:,:,1) = Rc;adaptImage(:,:,2) = Gc;adaptImage(:,:,3) = Bc;	XYZ_adapt = changeColorSpace(adaptImage, Mi);